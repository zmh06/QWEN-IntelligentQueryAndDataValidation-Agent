# Data QA Agent 测试用例优化

本文件提供对 [test_cases.yaml](../tests/test_cases.yaml) 的优化建议和新增测试用例模板，以提升测试覆盖率和系统稳定性。

## ✅ 当前测试覆盖情况

| 测试编号 | 输入 | 预期输出格式 | 测试目的 |
|----------|------|---------------|----------|
| TC001 | "数据库中现在有多少张表？" | 自然语言描述，如'数据库中现在有X张表。' | 验证系统能够正确统计并返回数据库中的表数量 |
| TC002 | "分别是哪几张？" | 表格格式，使用psql风格的表格边框 | 验证系统能够正确列出数据库中的所有表格 |
| TC003 | "执行规则 R001" | 执行结果描述 | 验证系统能够正确执行数据质量规则检查 |
| TC004 | "员工表的邮箱字段不能为空" | 执行结果描述 | 验证系统能够根据自然语言描述正确执行对应的数据质量规则 |
| TC005 | "显示所有销售数据" | 表格格式，包含id、region、sales、order_date字段，使用psql风格的表格 | 验证系统能够正确查询并格式化显示所有销售数据 |
| TC006 | "显示East地区的销售数据" | 表格格式，使用psql风格的表格 | 验证系统能够正确查询并格式化显示特定地区的销售数据 |
| TC007 | "显示2024年第一季度的销售数据" | 表格格式，使用psql风格的表格 | 验证系统能够正确解析时间范围描述，并查询对应时间段的数据 |
| TC008 | "显示所有员工信息" | 表格格式，使用psql风格的表格 | 验证系统能够正确查询并格式化显示员工信息 |
| TC009 | "显示邮箱为空的员工信息" | 表格格式，使用psql风格的表格 | 验证系统能够正确查询并格式化显示特定条件（邮箱为空）的员工信息 |
| TC010 | "显示电话为空的员工信息" | 表格格式，使用psql风格的表格 | 验证系统能够正确查询并格式化显示特定条件（电话为空）的员工信息 |

## 🧪 建议新增的测试用例

### 1. **边界情况测试**

| 测试编号 | 输入 | 预期输出格式 | 测试目的 |
|----------|------|---------------|----------|
| TC011 | ""（空输入） | 错误提示信息 | 验证系统对空输入的处理能力 |
| TC012 | "执行不存在的规则R999" | 错误提示信息 | 验证系统对无效规则ID的容错能力 |
| TC013 | "显示所有销售数据并按金额排序" | 表格格式，包含id、region、sales、order_date字段 | 验证复杂查询语句生成能力 |
| TC014 | "列出销售额大于1000的所有记录" | 表格格式，包含id、region、sales、order_date字段 | 验证带过滤条件的SQL生成能力 |

### 2. **自然语言多样性测试**

| 测试编号 | 输入 | 预期输出格式 | 测试目的 |
|----------|------|---------------|----------|
| TC015 | "数据库里有多少张表？" | 自然语言描述，如'数据库中现在有X张表。' | 验证同义词识别能力 |
| TC016 | "帮我查一下员工信息" | 表格格式，使用psql风格边框 | 验证模糊查询意图识别 |
| TC017 | "展示电话号码为空的员工" | 表格格式，使用psql风格边框 | 验证复杂条件查询识别 |

### 3. **大模型输出验证边界测试**

| 测试编号 | 输入 | 预期输出格式 | 实际输出 | 测试目的 |
|----------|------|---------------|-----------|----------|
| TC018 | "显示所有销售数据" | 表格格式，包含id、region、sales、order_date字段 | 多行数据结果 | 验证大模型输出格式一致性 |
| TC019 | "列出所有员工信息" | 表格格式，包含id、name、email、phone、department_id字段 | 多行数据结果 | 验证表格对齐和列名准确性 |
| TC020 | "告诉我邮箱为空的员工有哪些" | 表格格式或自然语言描述 | 多行数据结果 | 验证混合输出格式兼容性 |
# 测试用例优化建议

本项目当前的测试用例已覆盖基本功能，包括数据查询、规则执行、上下文扩展等场景。为进一步提升测试覆盖率和稳定性，建议添加以下测试用例：

## ✅ 当前覆盖的功能点
- 数据库表数量统计（自然语言输出）
- 表结构查询
- 规则执行与配置
- 上下文感知输入改写

## 🧪 建议新增的测试用例

### 1. **边界情况测试**

| 输入 | 预期输出格式 | 测试目的 |
|------|---------------|----------|
| ""（空输入） | 错误提示信息 | 验证系统对空输入的处理能力 |
| "执行不存在的规则R999" | 错误提示信息 | 验证系统对无效规则ID的容错能力 |
| "显示所有销售数据并按金额排序" | 表格格式，包含id、region、sales、order_date字段 | 验证复杂查询语句生成能力 |
| "列出销售额大于1000的所有记录" | 表格格式，包含id、region、sales、order_date字段 | 验证带过滤条件的SQL生成能力 |

### 2. **自然语言多样性测试**

| 输入 | 预期输出格式 | 测试目的 |
|------|---------------|----------|
| "数据库里有多少张表？" | 自然语言描述，如'数据库中现在有X张表。' | 验证同义词识别能力 |
| "帮我查一下员工信息" | 表格格式，使用psql风格边框 | 验证模糊查询意图识别 |
| "展示电话号码为空的员工" | 表格格式，使用psql风格边框 | 验证复杂条件查询识别 |

### 3. **大模型输出验证边界测试**

| 输入 | 预期输出格式 | 实际输出 | 测试目的 |
|------|---------------|-----------|----------|
| "显示所有销售数据" | 表格格式，包含id、region、sales、order_date字段，使用psql风格的表格 | 多行数据结果 | 验证大模型输出格式一致性 |
| "列出所有员工信息" | 表格格式，包含id、name、email、phone、department_id字段 | 多行数据结果 | 验证表格对齐和列名准确性 |
| "告诉我邮箱为空的员工有哪些" | 表格格式或自然语言描述 | 多行数据结果 | 验证混合输出格式兼容性 |

## 📌 使用建议

- 可将新增测试用例直接添加至 `tests/test_cases.yaml`
- 每个测试应包含：输入、期望输出格式、实际输出（运行后填充）、状态（通过/失败）
- 建议结合 GitHub Action CI 自动运行测试套件